# Exception hiearachy
* https://docs.python.org/3/library/exceptions.html#concrete-exceptions
* Exception inherits from BaseException


BaseException // base for build-in errors
* SystemExit
* GeneratorExit
* Exception // base for non-build-in errors (
  * ValueError // for invalid arguments (length, ...)
  * IndexError  // invalid index
  * KeyError  // (dict) key does not exist
  * TypeError // invalid dtype
  * IOError
  * NotImplementedError
  * RuntimeError // does not fit into any other category

try:
  raise Exception('error!')
except RuntimeError as e:
  handle runtime error
except ValueError as e:
  handle runtime error
except (IOError, IndexError) as e:
  handle either of these exceptions
except:
  catch everything (deprecated)
else:
  no exception
finally:
  always executed (with and without exception)


# Getting the full stack trace as a string
def get_current_stack_trace():
  exc_type, exc_value, exc_tb = sys.exc_info()
  return ''.join(traceback.format_exception(exc_type, exc_value, exc_tb))


# Formatting exceptions
* Use repr (f'{e:r}', '%r') for formatting instead of str (f'{e}')
* repr is more detailed; str shows only x when raising Exception(x)


# Re-raising exception
def fn():
  raise ValueError('fn')

try:
  fn()
except BaseException:
  logging.exception('Exception occurred') // not not require `as e` and adding e! Does not shut down;
  logging.fatal('Exception occurred') // Shuts down but does not show exception

  raise  # Only original location, not this location
  raise ValueError('Extra') from None # only this location
  raise ValueError('Extra') from e  # Both this and original location; this exception is consequence of orignal
    e.add_note('Extra') // alternative to only add extra notes without showing this location
    raise
  raise ValueError('Extra) # Both this and original location but this exception is considered separately: 'During handling of the above exception, another exception occurred:'


## Suppress the root source message -> raise from None
raise ValueError('Only this message is shown') from None


## What not to do
  raise e
* Python3: shows the line of `raise e` in the stack although it is not needed
           requires defining e
* Python2: does not show the source error message


# Logging exceptions
try:
  ...
except Exception as e:
  logging.exception('Exception occurred!') // does not require including e in the message!
  logging.error('Exception occurred %s', e)  // don't use str()! Does not include exception class, chained exceptions, and exception notes
  logging.error('Exception occurred %r', e)  // repr is better than %s but does not include chained exceptions and exception notes!
  logging.error('Exception occurred %s', traceback.format_exception(e)) // also includes chained exceptions and exception notes
  logging.error('Exception occurred %s', traceback.format_exc())  // same as format_exception but does not require e


# Avoid catchig BaseException (e.g. sys.exit)
except Exception as e: // does not catch BaseException (okay)
except: // does catch BaseException (never use)


# Notes
* To add additional context information

try:
  raise ValueError('Foo')
except ValueError as e:
  e.add_note('Some note')
  raise

class MyException(Exception):
  __notes__ = ['note1', 'note2']


# Exception
* To raise multiple exceptions at the same time

raise ExceptionGroup('group1', [ValueError('foo'), RuntimeError('bar')])

# except*
* To catch indiviual exceptions of an exception group
* except ValueError does not catch ExceptionGroup with ValueError
* except* catches ValueError and ExceptionGroup with ValueError

try:
  raise ExceptionGroup('group1', [ValueError('foo'), RuntimeError('bar')])
except* ValueError:
  print('ValueError')
except* RuntimeError:
  print('RuntimeError')
